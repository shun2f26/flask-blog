{% extends "base.html" %}

{% block title %}新規投稿作成{% endblock %}

{% block content %}
<div class="py-10">
    <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-6 md:p-10">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">新規投稿の作成</h1>
        <p class="text-sm text-gray-500 mb-6">タイトル、本文、そして画像をアップロードして新しいコンテンツを作成します。</p>

        <!-- フォームアクションは 'create' エンドポイントに POST で送信されることを想定 -->
        <form id="postForm" class="space-y-6" action="{{ url_for('create') }}" method="POST" enctype="multipart/form-data">
            
            <!-- タイトル入力 -->
            <div>
                <label for="title" class="block text-lg font-medium text-gray-700 mb-2">タイトル</label>
                <!-- フォーム検証でエラーメッセージがある場合を想定 -->
                {% if form.title.errors %}
                <p class="text-red-500 text-sm mb-1">{% for error in form.title.errors %}{{ error }}{% endfor %}</p>
                {% endif %}
                <input type="text" id="title" name="title" required
                       class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-base"
                       placeholder="魅力的なタイトルを入力してください"
                       value="{{ form.title.data if form.title.data }}">
            </div>

            <!-- 本文入力 -->
            <div>
                <label for="body" class="block text-lg font-medium text-gray-700 mb-2">本文</label>
                {% if form.body.errors %}
                <p class="text-red-500 text-sm mb-1">{% for error in form.body.errors %}{{ error }}{% endfor %}</p>
                {% endif %}
                <textarea id="body" name="body" rows="8" required
                          class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-base resize-y"
                          placeholder="投稿の本文を記述してください。">{{ form.body.data if form.body.data }}</textarea>
            </div>

            <!-- カテゴリ選択 (オプション) -->
             <div>
                <label for="category" class="block text-lg font-medium text-gray-700 mb-2">カテゴリ (オプション)</label>
                <select id="category" name="category"
                        class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-base">
                    <option value="">カテゴリを選択</option>
                    <option value="Tech">テクノロジー</option>
                    <option value="Life">ライフスタイル</option>
                    <option value="Food">食べ物</option>
                    <!-- 実際にはバックエンドからカテゴリリストを渡す想定 -->
                </select>
            </div>

            <!-- 画像ファイル入力 (Cloudinary連携想定) -->
            <div>
                <label for="image" class="block text-lg font-medium text-gray-700 mb-2">画像ファイルの選択 (オプション)</label>
                <input type="file" id="image" name="image" accept="image/*"
                       class="block w-full text-sm text-gray-600
                              file:mr-4 file:py-2 file:px-4
                              file:rounded-full file:border-0
                              file:text-sm file:font-semibold
                              file:bg-indigo-50 file:text-indigo-700
                              hover:file:bg-indigo-100 cursor-pointer">
                
                <!-- 画像プレビュー -->
                <div id="image-preview-container" class="mt-4 hidden">
                    <p class="text-sm font-medium text-gray-500 mb-2">プレビュー:</p>
                    <img id="image-preview" src="#" alt="Image Preview" class="max-w-full h-auto rounded-lg shadow-md border border-gray-200 object-cover" style="max-height: 300px;">
                </div>
            </div>

            <!-- CSRFトークン (Flask-WTFなどを想定) -->
            <!-- {{ form.csrf_token }} -->

            <!-- 送信ボタン -->
            <div>
                <button type="submit" id="submitButton"
                        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                    <i class="fas fa-paper-plane mr-2"></i> 投稿を保存
                </button>
            </div>

        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const imageInput = document.getElementById('image');
        const imagePreview = document.getElementById('image-preview');
        const imagePreviewContainer = document.getElementById('image-preview-container');

        // --- 画像プレビュー機能 ---
        imageInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreviewContainer.classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            } else {
                imagePreview.src = '#';
                imagePreviewContainer.classList.add('hidden');
            }
        });
    });
</script>
{% endblock %}
