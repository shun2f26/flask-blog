{% extends "base.html" %}

{% block title %}新規投稿{% endblock %}

{% block content %}
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    body { font-family: "Inter", sans-serif; }
    /* エラーメッセージ用のカスタムスタイル */
    .error-message {
        font-size: 0.875rem; /* text-sm */
        color: #ef4444; /* text-red-500 */
        margin-top: 0.25rem;
    }
</style>

<div class="min-h-screen bg-gray-100 p-4 sm:p-8">
    <div class="max-w-4xl mx-auto">
        
        <!-- ヘッダー -->
        <div class="mb-8 p-6 bg-white shadow-xl rounded-xl border-t-4 border-indigo-500">
            <h1 class="text-3xl font-extrabold text-gray-900 mb-2">
                <i class="fas fa-pen-nib text-indigo-500 mr-3"></i>
                新規投稿作成
            </h1>
            <!-- 説明文を更新 -->
            <p class="text-gray-500">新しいブログ記事を作成し、画像または動画を個別に追加して公開します。</p>
        </div>

        <!-- 投稿フォーム -->
        <!-- ファイルアップロードを可能にするため、enctype="multipart/form-data" を追加 -->
        <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
            <!-- フォームのメソッドとアクションは維持 -->
            <form method="POST" action="{{ url_for('create') }}" enctype="multipart/form-data">
                {{ form.hidden_tag() }}

                <!-- 1. タイトルフィールド -->
                <div class="mb-6">
                    {{ form.title.label(class="block text-lg font-semibold text-gray-700 mb-2") }}
                    {{ form.title(class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150", placeholder="記事のタイトルを入力してください") }}
                    
                    {% if form.title.errors %}
                        {% for error in form.title.errors %}
                            <p class="error-message">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>

                <!-- 2. 本文フィールド (form.content) -->
                <div class="mb-6">
                    {{ form.content.label(class="block text-lg font-semibold text-gray-700 mb-2") }}
                    {{ form.content(class="mt-1 block w-full h-72 px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 resize-y", placeholder="記事の本文をMarkdown形式などで入力してください") }}
                    
                    {% if form.content.errors %}
                        {% for error in form.content.errors %}
                            <p class="error-message">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>

                <!-- 3. 画像ファイルフィールド (form.image) -->
                <div class="mb-6 border p-4 rounded-lg bg-gray-50">
                    <label for="{{ form.image.id }}" class="block text-lg font-semibold text-gray-700 mb-2">
                        <i class="fas fa-image mr-2 text-indigo-500"></i>画像ファイル (オプション)
                    </label>
                    {{ form.image(class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-white focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100") }}
                    
                    {% if form.image.errors %}
                        {% for error in form.image.errors %}
                            <p class="error-message">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                    <p class="text-sm text-gray-500 mt-2">許可される形式: JPG, PNG, GIF</p>
                </div>
                
                <!-- 4. 動画ファイルフィールド (form.video を追加) -->
                <!-- WTForms側で 'video' という名前の FileField が定義されていることを想定します -->
                {% if form.video %}
                <div class="mb-8 border p-4 rounded-lg bg-gray-50">
                    <label for="{{ form.video.id }}" class="block text-lg font-semibold text-gray-700 mb-2">
                        <i class="fas fa-video mr-2 text-indigo-500"></i>動画ファイル (オプション)
                    </label>
                    {{ form.video(class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-white focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100") }}
                    
                    {% if form.video.errors %}
                        {% for error in form.video.errors %}
                            <p class="error-message">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                    <p class="text-sm text-gray-500 mt-2">許可される形式: MP4</p>
                </div>
                {% endif %}

                <!-- 5. 送信ボタン -->
                <div class="flex justify-end space-x-4">
                    <a href="{{ url_for('admin') }}" class="inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 shadow-sm transition duration-150">
                        キャンセル
                    </a>
                    {{ form.submit(class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-lg shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 cursor-pointer") }}
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
