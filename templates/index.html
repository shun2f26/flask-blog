<!-- 画像/動画表示エリア -->
<div class="md:w-1/3 flex-shrink-0">
    <a href="{{ url_for('view', post_id=post.id) }}" class="block">
    {% set CLOUD_NAME = config.get('CLOUDINARY_CLOUD_NAME', '') %}
    {% set is_video = post.video_public_id and post.video_public_id != '' %}
    {% set is_image = post.image_public_id and post.image_public_id != '' %}
    
    {% if CLOUD_NAME and (is_video or is_image) %}
        {% if is_video %}
            {% set public_id = post.video_public_id.replace('.mp4', '') %}
            {% set thumbnail_url = 'https://res.cloudinary.com/' + CLOUD_NAME + '/video/upload/so_0/w_400,h_225,c_fill,g_auto:face,f_jpg,q_auto/' + public_id + '.jpg' %}
            <div class="video-container rounded-lg shadow-md overflow-hidden bg-gray-900 relative">
                <img 
                    src="{{ thumbnail_url }}" 
                    alt="{{ post.title }} の動画サムネイル" 
                    class="w-full h-full object-cover"
                    onerror="this.onerror=null; this.src='https://placehold.co/400x225/374151/FFFFFF?text=VIDEO+THUMBNAIL+ERROR';"
                >
                <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 hover:bg-opacity-10 transition duration-300">
                    <i class="fas fa-play-circle text-white text-5xl opacity-80"></i>
                </div>
            </div>
        {% else %}
            {% set public_id = post.image_public_id %}
            {% set img_url = 'https://res.cloudinary.com/' + CLOUD_NAME + '/image/upload/w_400,h_225,c_fill,g_auto,f_auto,q_auto/' + public_id %}
            <div class="video-container rounded-lg shadow-md overflow-hidden">
                <img 
                    src="{{ img_url }}" 
                    alt="{{ post.title }} の画像" 
                    class="w-full h-full object-cover"
                    onerror="this.onerror=null; this.src='https://placehold.co/400x225/F87171/FFFFFF?text=IMAGE+ERROR';"
                >
            </div>
        {% endif %}
    {% else %}
        <!-- メディアなし or 設定エラー -->
        <div class="video-container bg-gray-200 rounded-lg shadow-inner flex items-center justify-center text-gray-500 text-lg placeholder">
            {% if post.image_public_id or post.video_public_id %}
                <i class="fas fa-exclamation-triangle text-xl mr-2"></i> 設定エラー
            {% else %}
                メディアなし
            {% endif %}
        </div>
    {% endif %}
    </a>
</div>
