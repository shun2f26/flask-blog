<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask Blog | è¨˜äº‹ã‚’ç·¨é›†</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN for modern icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šï¼šãƒ•ã‚©ãƒ³ãƒˆã¨èƒŒæ™¯ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f6;
        }
        .container {
            /* Tailwind's mx-auto utility for centering and fluid width */
            width: 100%;
            margin-right: auto;
            margin-left: auto;
        }
        /* Custom styling for file input to match theme */
        .file-input-custom::-webkit-file-upload-button {
            border: 0;
            padding: 0.5rem 1rem;
            border-radius: 9999px; /* rounded-full */
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            background-color: #fee2e2; /* red-100 */
            color: #b91c1c; /* red-700 */
            cursor: pointer;
            transition: background-color 0.15s;
        }
        .file-input-custom::file-selector-button {
            border: 0;
            padding: 0.5rem 1rem;
            border-radius: 9999px; /* rounded-full */
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            background-color: #fee2e2; /* red-100 */
            color: #b91c1c; /* red-700 */
            cursor: pointer;
            transition: background-color 0.15s;
        }
        .file-input-custom:hover::-webkit-file-upload-button,
        .file-input-custom:hover::file-selector-button {
            background-color: #fecaca; /* red-200 */
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Navbar (ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰çµ±åˆ) -->
    <nav class="bg-white shadow-lg sticky top-0 z-10">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0">
                    <a href="#index" class="text-xl font-bold text-gray-800 hover:text-red-600 transition duration-150">
                        My Flask Blog
                    </a>
                </div>
                <!-- èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ -->
                <div class="flex items-center space-x-4">
                    <!-- ç®¡ç†è€…ãƒªãƒ³ã‚¯ (ãƒ¢ãƒƒã‚¯) -->
                    <a href="#admin" class="text-gray-600 hover:text-red-600 px-3 py-2 rounded-md text-sm font-medium flex items-center">
                        <i data-lucide="shield" class="w-4 h-4 mr-1"></i> ç®¡ç†è€…
                    </a>
                    <!-- æ–°è¦æŠ•ç¨¿ -->
                    <a href="#create" class="bg-red-600 text-white hover:bg-red-700 px-3 py-2 rounded-lg text-sm font-medium transition duration-150 flex items-center shadow-md">
                        <i data-lucide="plus-circle" class="w-4 h-4 mr-1"></i> æ–°è¦æŠ•ç¨¿
                    </a>
                    <!-- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ -->
                    <a href="#logout" class="text-gray-600 hover:text-red-600 px-3 py-2 rounded-md text-sm font-medium flex items-center">
                        <i data-lucide="log-out" class="w-4 h-4 mr-1"></i> ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Flash Messages (ãƒ¢ãƒƒã‚¯ã®æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º) -->
    <div class="container mx-auto px-4 pt-4">
        <!-- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ¢ãƒƒã‚¯ -->
        <div class="p-3 mb-4 rounded-lg shadow-md bg-green-100 text-green-800 border border-green-300" role="alert">
            <span class="font-semibold">é€šçŸ¥:</span> è¨˜äº‹ã‚’ç·¨é›†ã—ã¦ã„ã¾ã™ã€‚å¤‰æ›´ã‚’ä¿å­˜ã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚
        </div>
    </div>

    <!-- Main Content Block - è¨˜äº‹ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 flex-grow">
        <div class="max-w-3xl mx-auto bg-white p-8 md:p-10 rounded-xl shadow-2xl border border-gray-100">
            <h1 class="text-3xl font-extrabold text-gray-900 mb-6 border-b pb-3 flex items-center">
                <i data-lucide="edit" class="w-7 h-7 mr-3 text-red-600"></i> è¨˜äº‹ã‚’ç·¨é›†
            </h1>
            
            <!-- ãƒ•ã‚©ãƒ¼ãƒ ã®é–‹å§‹ -->
            <form id="edit-post-form" action="#update_submit" method="POST" enctype="multipart/form-data">
                
                <!-- ã‚¿ã‚¤ãƒˆãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
                <div class="mb-6">
                    <label for="title" class="block text-sm font-medium text-gray-700 mb-1">ã‚¿ã‚¤ãƒˆãƒ« <span class="text-red-500">*</span></label>
                    <!-- Jinja2: {{ form.title(class="...", value=post.title) }} -->
                    <input type="text" id="title" name="title" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 shadow-sm text-gray-900"
                           placeholder="è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                </div>

                <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
                <div class="mb-6">
                    <label for="content" class="block text-sm font-medium text-gray-700 mb-1">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ <span class="text-red-500">*</span></label>
                    <!-- Jinja2: {{ form.content(class=...) }} -->
                    <textarea id="content" name="content" rows="15" required
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 shadow-sm text-gray-900"
                              placeholder="è¨˜äº‹ã®æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆHTMLã‚‚åˆ©ç”¨å¯èƒ½ï¼‰"></textarea>
                </div>

                <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
                <div class="mb-6 p-4 border border-red-200 rounded-lg bg-red-50">
                    <h3 class="text-lg font-semibold text-red-700 mb-3 flex items-center">
                        <i data-lucide="image" class="w-5 h-5 mr-2"></i> ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒ
                    </h3>
                    
                    <!-- ç¾åœ¨ã®ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                    <div id="image-preview-container" class="mb-4">
                        <p class="text-sm text-gray-600 mb-2">ç¾åœ¨ã®ç”»åƒ:</p>
                        <div id="current-image" class="w-full h-48 bg-gray-200 rounded-lg overflow-hidden flex items-center justify-center border border-gray-300">
                            <!-- ç”»åƒãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã¾ã™ (JSã«ã‚ˆã£ã¦ãƒ­ãƒ¼ãƒ‰) -->
                        </div>
                    </div>
                    
                    <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
                    <div class="mb-4">
                        <label for="image_file" class="block text-sm font-medium text-gray-700 mb-1">æ–°ã—ã„ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (ä»»æ„)</label>
                        <!-- Jinja2: {{ form.image_file(class="...") }} -->
                        <input type="file" id="image_file" name="image_file" accept="image/*" 
                               class="block w-full text-sm text-gray-500 file-input-custom">
                        <p class="mt-1 text-xs text-gray-500">JPG, PNG, GIF, æœ€å¤§ 5MBã€‚</p>
                    </div>

                    <!-- ç”»åƒå‰Šé™¤ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ (æ—¢å­˜ã®ç”»åƒãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤º) -->
                    <div id="delete-image-option" class="flex items-center mt-3 hidden">
                        <!-- Jinja2: {{ form.delete_image(class="...") }} -->
                        <input id="delete_image" name="delete_image" type="checkbox"
                               class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                        <label for="delete_image" class="ml-2 block text-sm font-medium text-red-700">ç¾åœ¨ã®ç”»åƒã‚’å‰Šé™¤ã™ã‚‹</label>
                    </div>
                </div>

                <!-- ãƒ•ã‚©ãƒ¼ãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                <div class="mt-8 pt-6 border-t flex flex-col sm:flex-row justify-between space-y-3 sm:space-y-0 sm:space-x-4">
                    <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
                    <a href="#view" id="cancel-link" class="order-2 sm:order-1 inline-flex justify-center items-center px-6 py-3 border border-gray-300 shadow-sm text-base font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition duration-150">
                        <i data-lucide="x" class="w-5 h-5 mr-2"></i> ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                    </a>
                    <!-- æ›´æ–°ãƒœã‚¿ãƒ³ -->
                    <button type="submit" class="order-1 sm:order-2 inline-flex justify-center items-center px-6 py-3 border border-transparent shadow-md text-base font-medium rounded-lg text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150">
                        <i data-lucide="save" class="w-5 h-5 mr-2"></i> è¨˜äº‹ã‚’æ›´æ–°
                    </button>
                    <!-- å‰Šé™¤ãƒœã‚¿ãƒ³ -->
                    <button type="button" id="delete-button" class="order-3 inline-flex justify-center items-center px-6 py-3 border border-red-300 shadow-sm text-base font-medium rounded-lg text-red-700 bg-red-50 hover:bg-red-100 transition duration-150">
                        <i data-lucide="trash-2" class="w-5 h-5 mr-2"></i> è¨˜äº‹ã‚’å‰Šé™¤
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Footer (ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰çµ±åˆ) -->
    <footer class="bg-gray-800 text-white py-4 mt-auto">
        <div class="container mx-auto text-center text-sm">
            &copy; 2024 Flask Blog App. All Rights Reserved.
        </div>
    </footer>

    <script>
        // Lucide Iconsã®å®Ÿè¡Œ
        lucide.createIcons();

        // ãƒ¢ãƒƒã‚¯è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ (Flaskã® 'post' å¤‰æ•°ã«ç›¸å½“)
        const mockPost = {
            id: 123,
            title: "ã€é‡è¦ã€‘Flask Blogã®å¤§å¹…ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ãŠçŸ¥ã‚‰ã›",
            content: "ã“ã‚Œã¯æ—¢å­˜ã®è¨˜äº‹ã®æœ¬æ–‡ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç·¨é›†ã™ã‚‹ãŸã‚ã«ã€DBã‹ã‚‰å–å¾—ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã“ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«äº‹å‰ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚å†…å®¹ã‚’ä¿®æ­£ã—ã€ä¸‹ã®ã€Œè¨˜äº‹ã‚’æ›´æ–°ã€ãƒœã‚¿ãƒ³ã§ä¿å­˜ã—ã¦ãã ã•ã„ã€‚",
            public_id: 'sample_image_id', // ç”»åƒãŒã‚ã‚‹å ´åˆ
            // public_id: null, // ç”»åƒãŒãªã„å ´åˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            author_id: 1,
        };

        const postImagePlaceholder = "https://placehold.co/600x240/b91c1c/ffffff?text=Current+Thumbnail";

        /**
         * è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ­ãƒ¼ãƒ‰ã—ã€ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¨­å®šã—ã¾ã™ã€‚
         */
        function loadPostData() {
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¸ã®ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰
            document.getElementById('title').value = mockPost.title;
            document.getElementById('content').value = mockPost.content;

            const currentImageDiv = document.getElementById('current-image');
            const deleteOptionDiv = document.getElementById('delete-image-option');
            const cancelLink = document.getElementById('cancel-link');

            // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã®ãƒªãƒ³ã‚¯ã‚’è¨˜äº‹è©³ç´°ãƒ“ãƒ¥ãƒ¼ã«æˆ»ã‚‹ã‚ˆã†ã«è¨­å®šï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
            cancelLink.href = `#view/${mockPost.id}`;

            if (mockPost.public_id) {
                // ç”»åƒãŒã‚ã‚‹å ´åˆã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨å‰Šé™¤ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                currentImageDiv.innerHTML = `
                    <img src="${postImagePlaceholder}" 
                         alt="ç¾åœ¨ã®ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" 
                         class="w-full h-full object-cover">
                `;
                deleteOptionDiv.classList.remove('hidden');
            } else {
                // ç”»åƒãŒãªã„å ´åˆã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’è¡¨ç¤º
                currentImageDiv.innerHTML = `
                    <div class="text-gray-500 text-sm font-medium">ç¾åœ¨ã®ç”»åƒã¯ã‚ã‚Šã¾ã›ã‚“</div>
                `;
                deleteOptionDiv.classList.add('hidden');
            }
        }

        /**
         * å‰Šé™¤ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«UIã®ä»£ã‚ã‚Šã«confirmã§ä»£ç”¨ï¼‰
         */
        document.getElementById('delete-button').addEventListener('click', () => {
            // ğŸš¨ æ³¨æ„: å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€alert()/confirm()ã®ä»£ã‚ã‚Šã«ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
            const isConfirmed = confirm('æœ¬å½“ã«ã“ã®è¨˜äº‹ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚');
            if (isConfirmed) {
                // ã“ã“ã§å‰Šé™¤APIã‚’å‘¼ã³å‡ºã™
                console.log(`è¨˜äº‹ ID: ${mockPost.id} ã‚’å‰Šé™¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¾ã—ãŸã€‚`);
                alert('è¨˜äº‹ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚');
                // å‰Šé™¤å¾Œã€ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ãªã©ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
                window.location.hash = '#index';
            }
        });

        /**
         * ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
         */
        document.getElementById('edit-post-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            // ãƒ‡ãƒ¼ã‚¿ã®åé›†ã¨æ¤œè¨¼ï¼ˆã“ã“ã§ã¯çœç•¥ï¼‰
            const newTitle = document.getElementById('title').value;
            const deleteImage = document.getElementById('delete_image').checked;
            
            console.log('è¨˜äº‹æ›´æ–°ã®å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™...');
            console.log('æ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«:', newTitle);
            console.log('ç”»åƒã‚’å‰Šé™¤ã™ã‚‹ã‹:', deleteImage);
            
            // æ›´æ–°å‡¦ç†å¾Œã€è¨˜äº‹è©³ç´°ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
            alert(`è¨˜äº‹ ${mockPost.id} ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸï¼`);
            window.location.hash = `#view/${mockPost.id}`;
        });

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
        document.addEventListener('DOMContentLoaded', loadPostData);
    </script>
</body>
</html>
