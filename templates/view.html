{% extends 'base.html' %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
<article class="bg-white p-8 rounded-xl shadow-2xl">
<h1 class="text-4xl font-extrabold text-gray-900 mb-4">{{ post.title }}</h1>

    <div class="flex items-center text-sm text-gray-500 mb-6 border-b pb-3">
        <span class="mr-4"><i class="fas fa-user-circle mr-1"></i> 
            <a href="{{ url_for('user_blog', username=post.author.username) }}" class="hover:text-indigo-600">{{ post.author.username }}</a>
        </span>
        <span class="mr-4"><i class="fas fa-clock mr-1"></i> {{ post.create_at.strftime('%Y年%m月%d日 %H:%M') }}</span>
    </div>

    <!-- 記事画像表示 -->
    {% set image_url = get_cloudinary_url(post.public_id, width=800, crop="limit") %}
    {% if image_url %}
    <div class="mb-8 w-full">
        <img src="{{ image_url }}" 
             alt="{{ post.title }} のメイン画像" 
             class="rounded-lg shadow-lg max-w-full h-auto mx-auto" />
    </div>
    {% endif %}

    <!-- 記事本文 -->
    <div class="prose max-w-none text-gray-700 leading-relaxed break-words whitespace-pre-wrap">
        {{ post.content }}
    </div>

    <!-- 編集・削除ボタン -->
    {% if current_user.is_authenticated and (current_user.id == post.user_id or current_user.is_admin) %}
    <div class="mt-10 pt-6 border-t flex space-x-4">
        <a href="{{ url_for('update', post_id=post.id) }}" 
           class="py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 transition">
            <i class="fas fa-edit"></i> 編集
        </a>
        <form method="POST" action="{{ url_for('delete', post_id=post.id) }}" class="inline" onsubmit="return confirm('本当にこの記事を削除しますか？');">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" 
                    class="py-2 px-4 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition">
                <i class="fas fa-trash-alt"></i> 削除
            </button>
        </form>
    </div>
    {% endif %}
</article>
<div class="mt-8 text-center">
    <a href="{{ url_for('index') }}" class="text-indigo-600 hover:text-indigo-800 transition text-lg font-medium">
        <i class="fas fa-arrow-left mr-1"></i> 記事一覧に戻る
    </a>
</div>

</div>
{% endblock %}
