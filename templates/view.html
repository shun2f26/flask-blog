{% extends "base.html" %}
{% block content %}

<div class="max-w-4xl mx-auto mt-10 px-4 bg-white p-6 rounded-xl shadow">

    <h1 class="text-3xl font-bold mb-2">{{ post.title }}</h1>

    <p class="text-gray-500 text-sm mb-6">
        <i class="fa-regular fa-clock mr-1"></i>{{ post.created_at|datetimeformat }}
        &nbsp;|&nbsp;
        <i class="fa-solid fa-user mr-1"></i>{{ post.author.username }}
    </p>

    <!-- 画像 or 動画プレイヤー -->
    {% if post.image_public_id %}
        <img src="{{ post.image_url }}" class="w-full rounded mb-6 shadow">
    
    {% elif post.video_public_id %}
        <video controls class="w-full rounded mb-6 shadow">
            <source src="{{ post.video_url }}" type="video/mp4">
            お使いのブラウザは動画再生に対応していません。
        </video>
    {% endif %}

    <div class="prose text-lg mb-8">
        {{ post.content | safe }}
    </div>

    <hr class="my-6">

    <!-- コメント一覧 -->
    <h2 class="text-2xl font-bold flex items-center mb-3">
        <i class="fa-solid fa-comments mr-2 text-purple-600"></i> コメント一覧
    </h2>

    {% if comments %}
        {% for c in comments %}
            <div class="border-b py-3">
                <p class="font-bold">{{ c.name }}</p>
                <p>{{ c.content }}</p>
                <p class="text-gray-400 text-sm">{{ c.created_at|datetimeformat }}</p>
            </div>
        {% endfor %}
    {% else %}
        <p class="text-gray-500">まだコメントはありません。</p>
    {% endif %}

    <!-- コメントフォーム -->
    <h2 class="text-2xl font-bold flex items-center mt-8">
        <i class="fa-solid fa-pen mr-2 text-green-600"></i> コメントを書く
    </h2>

    <form action="{{ url_for('comment', post_id=post.id) }}" method="POST" class="mt-4">
        {{ form.csrf_token }}

        <label class="block mb-2 font-bold">名前</label>
        {{ form.name(class="w-full p-2 border rounded mb-4") }}

        <label class="block mb-2 font-bold">コメント</label>
        {{ form.content(class="w-full p-2 h-32 border rounded mb-4") }}

        <button class="px-6 py-2 bg-purple-600 text-white rounded shadow hover:bg-purple-700">
            投稿
        </button>
    </form>

</div>

{% endblock %}
