{% extends "base.html" %}
{# 外部ファイルからメディアレンダリングマクロをインポート #}
{% from "_video_embed.html" import render_media %}

{% block title %}
{{ post.title }}
{% endblock %}

{% block content %}
{# Tailwind CSS と Font Awesome の読み込み #}
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <article class="bg-white p-8 rounded-2xl shadow-xl">
        <header class="mb-8 border-b pb-4">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-2">{{ post.title }}</h1>
            <div class="text-sm text-gray-500 flex items-center space-x-4">
                <span><i class="fas fa-user-edit mr-1"></i> {{ post.author.username }}</span>
                <span><i class="fas fa-calendar-alt mr-1"></i> {{ post.created_at.strftime('%Y/%m/%d %H:%M') }}</span>
            </div>
        </header>

        <!-- メディアの埋め込み (動画の場合はサムネイル付きで再生可能) -->
        {% set CLOUD_NAME = config.get('CLOUDINARY_CLOUD_NAME', '') %}
        {# render_mediaマクロを呼び出し、postオブジェクトとCloud Nameを渡す #}
        {# 任意の表示サイズ (width='800', height='450') を指定可能 #}
        <div class="mb-8">
            {{ render_media(post, CLOUD_NAME, width='800', height='450') }}
        </div>
        
        <div class="prose max-w-none mt-8 text-gray-700 leading-relaxed">
            <!-- 投稿コンテンツを安全に出力 -->
            <p>{{ post.content | safe }}</p>
        </div>

        <footer class="mt-12 pt-6 border-t flex justify-end">
            <a href="{{ url_for('index') }}" class="text-indigo-600 hover:text-indigo-800 font-medium transition duration-150 ease-in-out hover:underline">
                <i class="fas fa-arrow-left mr-2"></i> 投稿一覧に戻る
            </a>
        </footer>
    </article>
</div>
{% endblock %}
