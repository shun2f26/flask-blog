{% extends "base.html" %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
.post-container { max-width: 800px; margin: 0 auto; padding: 2rem; }
.post-content p { margin-bottom: 1.5rem; line-height: 1.8; }

/* 動画のアスペクト比維持 */
.video-container {
    width: 100%;
    aspect-ratio: 16 / 9;
    background-color: #000;
    border-radius: 0.75rem;
    overflow: hidden;
    margin-bottom: 1.5rem;
}
.video-container video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 0.75rem;
}

/* 画像スタイル */
.image-container img {
    max-height: 500px;
    width: 100%;
    object-fit: contain;
    border-radius: 0.75rem;
}
</style>

<div class="min-h-screen bg-gray-50 py-10 px-4">
    <div class="post-container bg-white shadow-2xl rounded-2xl">

        <h1 class="text-4xl font-extrabold text-gray-900 mb-2">{{ post.title }}</h1>

        <div class="flex items-center text-sm text-gray-500 mb-6 border-b pb-4">
            <span class="mr-3"><i class="fas fa-calendar-alt mr-1"></i> {{ post.created_at.strftime('%Y年%m月%d日') }}</span>
            <span class="mr-3"><i class="fas fa-user-edit mr-1"></i> {{ post.author.username }}</span>
            {% if current_user.is_authenticated and post.user_id == current_user.id %}
            <a href="{{ url_for('update', post_id=post.id) }}" class="ml-auto text-indigo-600 hover:text-indigo-800 font-medium">
                <i class="fas fa-edit mr-1"></i> 編集
            </a>
            {% endif %}
        </div>

        <!-- メディア表示 -->
        {% set CLOUD_NAME = config.get('CLOUDINARY_CLOUD_NAME', '') %}

        {% if post.video_public_id %}
        <div class="video-container mb-6 shadow-lg">
            <video controls preload="metadata" playsinline crossorigin="anonymous" class="w-full rounded-xl">
                <source src="https://res.cloudinary.com/{{ CLOUD_NAME }}/video/upload/{{ post.video_public_id }}.mp4" type="video/mp4">
                お使いのブラウザは動画タグをサポートしていません。
            </video>
        </div>

        {% if current_user.is_authenticated and current_user.is_admin %}
        <div class="flex justify-center mb-6">
            <a href="https://res.cloudinary.com/{{ CLOUD_NAME }}/video/upload/{{ post.video_public_id }}.mp4"
                download="{{ post.title|replace(' ', '_') }}.mp4"
                class="inline-flex items-center py-3 px-6 rounded-full shadow-lg text-lg font-semibold text-white bg-green-600 hover:bg-green-700 transition duration-150 ease-in-out">
                <i class="fas fa-download mr-2"></i> 動画をダウンロード (MP4)
            </a>
        </div>
        {% endif %}

        {% elif post.image_public_id %}
        <div class="image-container mb-6">
            <img src="https://res.cloudinary.com/{{ CLOUD_NAME }}/image/upload/f_auto,q_auto/{{ post.image_public_id }}" 
                 alt="{{ post.title }}の画像" class="shadow-lg rounded-xl">
        </div>
        {% endif %}

        <!-- 本文 -->
        <div class="post-content text-gray-700 text-lg">
            {{ post.content | replace('\n', '<br>') | safe }}
        </div>

    </div>
</div>
{% endblock %}
