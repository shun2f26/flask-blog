{% extends "base.html" %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
/* カスタムスタイル */
.post-container { max-width: 800px; margin: 0 auto; padding: 2rem; }
.post-content p { margin-bottom: 1.5rem; line-height: 1.8; }

/* 動画コンテナのスタイルを修正 */
.video-container {
    width: 100%;
    /* 高さを親要素に合わせるのではなく、アスペクト比を維持して自動調整するように修正 */
    padding-top: 56.25%; /* 16:9 のアスペクト比 (9/16 * 100%) */
    position: relative;
    background-color: #000;
    border-radius: 0.75rem;
    overflow: hidden;
    margin-bottom: 1.5rem;
}
.video-container video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain; /* 動画が枠内に収まるように設定 */
}

/* 画像の高さも統一 */
.image-container img {
    max-height: 500px;
    width: 100%;
    object-fit: contain;
    border-radius: 0.75rem;
}
</style>

<div class="min-h-screen bg-gray-50">
    <div class="post-container bg-white shadow-2xl rounded-2xl">

        <h1 class="text-4xl font-extrabold text-gray-900 mb-2">{{ post.title }}</h1>
        <div class="flex items-center text-sm text-gray-500 mb-6 border-b pb-4">
            <span class="mr-3"><i class="fas fa-calendar-alt mr-1"></i> {{ post.created_at.strftime('%Y年%m月%d日') }}</span>
            <span class="mr-3"><i class="fas fa-user-edit mr-1"></i> {{ post.author.username }}</span>
            {% if current_user.is_authenticated and post.user_id == current_user.id %}
            <a href="{{ url_for('update', post_id=post.id) }}" class="ml-auto text-indigo-600 hover:text-indigo-800 font-medium">
                <i class="fas fa-edit mr-1"></i> 編集
            </a>
            {% endif %}
        </div>
        
        <!-- メディア表示セクション -->
        {% if post.image_url %}
        <div class="image-container mb-6">
            <img src="{{ post.image_url }}" alt="{{ post.title }}の画像" class="shadow-lg">
        </div>
        {% elif post.video_url %}
        <div class="video-container mb-6 shadow-lg">
            <!-- 動画の読み込み元として post.video_url を使用 -->
            <video controls preload="metadata" playsinline>
                <source src="{{ post.video_url }}" type="video/mp4">
                お使いのブラウザは動画タグをサポートしていません。
            </video>
        </div>
        
        <!-- 動画ダウンロードボタンを修正 -->
        <div class="flex justify-center mb-6">
            <a href="{{ post.video_url }}" download="{{ post.title|replace(' ', '_') }}.mp4"
               class="inline-flex items-center py-3 px-6 border border-transparent rounded-full shadow-lg text-lg font-semibold text-white bg-green-600 hover:bg-green-700 transition duration-150 ease-in-out">
                <i class="fas fa-download mr-2"></i> 動画ファイルをダウンロード (MP4)
            </a>
        </div>
        {% endif %}

        <!-- 本文表示セクション -->
        <div class="post-content text-gray-700 text-lg">
            {{ post.content | replace('\n', '<br>') | safe }}
        </div>

    </div>
</div>
{% endblock %}
